@model PresentationLayer.Models.DashboardViewModel
@{
	ViewData["Title"] = "Ana Sayfa";
}

<div class="d-flex justify-content-between align-items-center mb-3">
	<h2 class="mb-0">Ana Sayfa</h2>
	<div></div>
</div>

<div class="row mb-4">
	<div class="col-xl-3 col-md-6">
		<div class="card text-white mb-4" style="background: linear-gradient(45deg, #6f42c1, #20c997);">
			<div class="card-body">Toplam Alış</div>
			<div class="card-footer d-flex align-items-center justify-content-between">
				<span class="fs-5 fw-bold">@Model.TotalPurchaseAmount.ToString("N2") ₺</span>
			</div>
		</div>
	</div>
	<div class="col-xl-3 col-md-6">
		<div class="card text-white mb-4" style="background: linear-gradient(45deg, #20c997, #6f42c1);">
			<div class="card-body">Toplam Satış</div>
			<div class="card-footer d-flex align-items-center justify-content-between">
				<span class="fs-5 fw-bold">@Model.TotalSalesAmount.ToString("N2") ₺</span>
			</div>
		</div>
	</div>
	<div class="col-xl-3 col-md-6">
		<div class="card bg-light mb-4">
			<div class="card-body">Fatura Sayısı</div>
			<div class="card-footer d-flex align-items-center justify-content-between">
				<span class="fs-5 fw-bold">@((Model.Invoices?.Count() ?? 0))</span>
			</div>
		</div>
	</div>
	<div class="col-xl-3 col-md-6">
		<div class="card bg-light mb-4">
			<div class="card-body">Cari Sayısı</div>
			<div class="card-footer d-flex align-items-center justify-content-between">
				<span class="fs-5 fw-bold">@((Model.Currents?.Count() ?? 0))</span>
			</div>
		</div>
	</div>
</div>

<div class="row">
	<div class="col-xl-6">
		<div class="card mb-4">
			<div class="card-header">
				<i class="fas fa-chart-bar me-1"></i>
				Alış vs Satış Tutarları
			</div>
			<div class="card-body"><canvas id="purchaseSalesChart" width="100%" height="40"></canvas></div>
		</div>
	</div>
	<div class="col-xl-6">
		<div class="card mb-4">
			<div class="card-header">
				<i class="fas fa-address-book me-1"></i>
				Cariler
			</div>
			<div class="card-body">
				@if (Model?.Currents != null && Model.Currents.Any())
				{
					<div class="table-responsive">
						<table class="table table-sm align-middle">
							<thead class="table-light">
								<tr>
									<th>Ad</th>
									<th class="text-end">Bakiye</th>
								</tr>
							</thead>
							<tbody>
								@foreach (var c in Model.Currents)
								{
									var cls = c.Balance >= 0 ? "text-success" : "text-danger";
									<tr>
										<td>@c.CurrentName</td>
										<td class="text-end @cls">@c.Balance.ToString("N2")</td>
									</tr>
								}
							</tbody>
						</table>
					</div>
				}
				else
				{
					<p>Henüz cari bulunamadı.</p>
				}
			</div>
		</div>
	</div>
</div>


@section Styles { }

	@section Scripts {
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<script>
							document.addEventListener('DOMContentLoaded', function () {

				// Chart: Alış vs Satış
				const ctx = document.getElementById('purchaseSalesChart');
				if (ctx && window.Chart) {
					const purchase = parseFloat('@Model.TotalPurchaseAmount.ToString(System.Globalization.CultureInfo.InvariantCulture)');
					const sales = parseFloat('@Model.TotalSalesAmount.ToString(System.Globalization.CultureInfo.InvariantCulture)');
					new Chart(ctx, {
						type: 'bar',
						data: {
							labels: ['Alış', 'Satış'],
							datasets: [{
								label: 'Tutar (₺)',
								data: [purchase, sales],
								backgroundColor: ['rgba(54, 162, 235, 0.5)', 'rgba(75, 192, 192, 0.5)'],
								borderColor: ['rgba(54, 162, 235, 1)', 'rgba(75, 192, 192, 1)'],
								borderWidth: 1
							}]
						},
						options: {
							responsive: true,
							scales: { y: { beginAtZero: true } }
						}
					});
				}
			});
		</script>
	}
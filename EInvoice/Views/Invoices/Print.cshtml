@{
	Layout = null;
}
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>e‑FATURA</title>
  <style>
    body { margin:0; font:13px/1.4 Arial, sans-serif; color:#000; background:#fff; }
    .sheet{ width:210mm; min-height:297mm; margin:0 auto; padding:12mm; border:1px solid #000; }

    .header{ display:flex; justify-content:space-between; align-items:flex-start; border-bottom:2px solid #002147; padding-bottom:6px; margin-bottom:6px; }
    .seller{ font-size:12px; max-width:40%; }
    .seller strong{ display:block; margin-bottom:4px; color:#002147; }
    .logo{ text-align:center; font-size:16px; font-weight:bold; color:#d0021b; }
    .logo div{ margin-top:4px; }
    .buyer{ font-size:12px; max-width:40%; text-align:left; }

    .meta{ float:right; margin:8px 0; width:50%; }
    .meta table{ width:100%; border-collapse:collapse; font-size:12px; }
    .meta td{ border:1px solid #000; padding:4px 6px; }
    .meta td:first-child{ font-weight:bold; background:#f2f2f2; width:160px; color:#000; }

    .ettn{ margin:10px 0; font-weight:bold; border:2px solid #002147; padding:6px; display:inline-block; background:#fafafa; color:#002147; }

    .items{ width:100%; border-collapse:collapse; font-size:12px; margin-top:6px; }
    .items th, .items td{ border:1px solid #000; padding:6px; }
    .items th{ background:#f2f2f2; text-align:center; color:#000; border:2px solid #002147; }
    .items td.num{ text-align:right; }

    .totals{ margin-top:8px; display:flex; justify-content:flex-end; }
    .totals table{ border-collapse:collapse; font-size:12px; width:60%; }
    .totals td{ border:1px solid #000; padding:6px; }
    .totals td:first-child{ background:#f2f2f2; font-weight:bold; color:#000; border-right:2px solid #002147; }
    .totals td.num{ text-align:right; }
    .totals .pay{ color:#d0021b; font-weight:bold; }

    .footbox{ margin-top:8px; border:1px solid #000; padding:8px; font-size:12px; background:#fafafa; }
    .bank{ margin-top:8px; font-size:12px; border:2px solid #002147; padding:6px; }
    .bank table{ width:100%; border-collapse:collapse; }
    .bank th, .bank td{ border:1px solid #000; padding:6px; text-align:left; }
    .bank th{ background:#f2f2f2; font-weight:bold; color:#000; border-bottom:2px solid #002147; }

    footer{ margin-top:15px; text-align:center; font-size:11px; color:#555; }
  </style>
</head>
<body>
  <section class="sheet" id="sheet"></section>
  <script>
    const params = new URLSearchParams(location.search);
    const id = Number(params.get('id'));
    (async function(){
      if (!id) { document.getElementById('sheet').innerHTML = '<div>Geçersiz fatura</div>'; return; }
      const res = await fetch('/Invoices/Get?id=' + id, { cache: 'no-store' });
      if (!res.ok) { document.getElementById('sheet').innerHTML = '<div>Fatura alınamadı</div>'; return; }
      const inv = await res.json();
      const lines = inv.lines || inv.Lines || [];
      const toStr = n => (Number(n)||0).toLocaleString('tr-TR');
      const rows = lines.map((l,i)=>{
        const qty = Number(l.quantity ?? l.Quantity);
        const price = Number(l.unitPrice ?? l.UnitPrice);
        const amount = qty * price;
        return `<tr><td>${i+1}</td><td>${l.productAndServiceId ?? l.ProductAndServiceId}</td><td>Ürün/Hizmet</td><td>${qty} Adet</td><td class="num">${toStr(price)} TL</td><td class="num">%0</td><td class="num">0 TL</td><td class="num">${toStr(amount)} TL</td></tr>`;
      }).join('');
      const total = lines.reduce((a,l)=>a + (Number(l.quantity ?? l.Quantity) * Number(l.unitPrice ?? l.UnitPrice)), 0);

      const html = `
        <div class="header">
          <div class="seller">
            <strong>Satıcı Bilgileri</strong>
            Adres: -<br>
            Web: -<br>
            E‑posta: -<br>
            Vergi Dairesi: -<br>
            TCKN/VKN: -
          </div>
          <div class="logo">
            <div style="width:120px;height:60px;border:1px solid #002147;margin:auto;"></div>
            <div>e‑FATURA</div>
          </div>
          <div class="buyer">
            <strong>SAYIN</strong><br>
            Alıcı: ${inv.customerSupplierId ?? inv.CustomerSupplierId}<br>
            Adres: -<br>
            E‑posta: -<br>
            Tel: -<br>
            Vergi Dairesi: -
          </div>
        </div>

        <div class="meta">
          <table>
            <tr><td>Özelleştirme No</td><td>TR1.2</td></tr>
            <tr><td>Senaryo</td><td>${inv.senario ?? inv.Senario}</td></tr>
            <tr><td>Fatura Tipi</td><td>${inv.type ?? inv.Type}</td></tr>
            <tr><td>Fatura No</td><td>${inv.no ?? inv.No}</td></tr>
            <tr><td>Fatura Tarihi</td><td>${inv.date ?? inv.Date}</td></tr>
            <tr><td>Gönderim Tarihi</td><td>-</td></tr>
            <tr><td>Muhasebe Fatura No</td><td>-</td></tr>
            <tr><td>Satış Kanalı</td><td>Diğer</td></tr>
          </table>
        </div>

        <div class="ettn">ETTN: -</div>

        <table class="items">
          <thead>
            <tr>
              <th>Sıra No</th>
              <th>Stok Kodu</th>
              <th>Mal Hizmet</th>
              <th>Miktar</th>
              <th>Birim Fiyat</th>
              <th>KDV Oranı</th>
              <th>KDV Tutarı</th>
              <th>Mal Hizmet Tutarı</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>

        <div class="totals">
          <table>
            <tr><td>Mal Hizmet Toplam Tutarı</td><td class="num">${toStr(total)} TL</td></tr>
            <tr><td>Toplam İskonto</td><td class="num">0 TL</td></tr>
            <tr><td>Hesaplanan KDV (%0)</td><td class="num">0 TL</td></tr>
            <tr><td>Vergiler Dahil Toplam Tutar</td><td class="num">${toStr(total)} TL</td></tr>
            <tr><td><strong>Ödenecek Tutar</strong></td><td class="num pay">${toStr(total)} TL</td></tr>
          </table>
        </div>

        <div class="footbox">
          <strong>Yalnız:</strong> -
        </div>

        <footer>Bu belge örnek fatura düzenidir.</footer>`;

      document.getElementById('sheet').innerHTML = html;
      if (params.get('print') === '1') { setTimeout(()=>window.print(), 200); }
    })();
  </script>
</body>
</html>